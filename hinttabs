// hinttaball shows tabs from all windows, hinttabs just the same window
// change t.maxColumns=3 to preference (1 is quite nice as a long list of tabs)
// it's simpler to make changes in the readable version (eg editing the styles) and then minify it


command hinttabs js if(void 0===tri.hinttabspopup){tri.hinttabspopup={};let t=tri.hinttabspopup;t.maxColumns=3,t.maxCells=30,t.widthPercentage=75,t.topOffset=7,t.minCellWidth=50,t.bTabIdInTitle=!1,t.gridGap="5px",t.bFavicons=!0,t.iconSize=1,t.stylerules=[".tri-grid-tabs-container { height: fit-content; font-family: var(--tridactyl-cmdl-font-family); color: var(--tridactyl-cmdl-fg); font-size: var(--tridactyl-cmdl-font-size); filter: drop-shadow(0 0 10rem #3a0080); }",".tri-grid-tabs-container>div { padding: 0.5em; overflow: clip; text-overflow: ellipsis; white-space: nowrap; text-align: left; background-color: #101216 !important; padding-left: 1.5em; padding-right: 1.5em; } ",".tri-grid-tabs-container>div>p { display: inline; } ",".tri-grid-tabs-container>div>p.tri-tab-title { color: #e4e4e4 !important; }",".tri-grid-tabs-container>div>p.tri-tab-url { color: slateblue !important; } ",".tri-grid-tabs-container>div>p>img { padding: 0 1em 0 0; display: inline-block; vertical-align: middle; height:"+t.iconSize+"em; }",".tri-grid-tabs-container>div.TridactylHintActive { background-color: #202020 !important; } ",".tri-grid-tabs-container>div.TridactylHintActive>p {  } ",".tri-grid-tabs-container>div.TridactylHintActive>p.tri-tab-title { color: white !important; }",".tri-grid-tabs-container>div.TridactylHintActive>p.tri-tab-url { color: yellow !important; } ",".tri-grid-tabs-container>div>p>img {  }",".tri-tabs-more { margin-left:"+t.gridGap+"; margin-right:"+t.gridGap+"; height:100%; background-color: #101216 !important; display: flex; align-items: center; justify-content: center; color: #e4e4e4 !important; } "],t.gridFromArr=function(t,e,i){t.length;let n=document.createElement("div");return n.setAttribute("style","grid-template-columns: repeat("+e+", minmax(0, 1fr));"),n.style.display="grid",t.forEach(function(t){let e=document.createElement("div");i(t,e),n.appendChild(e)}),n},t.addStylesheet=function(t){let e=document.createElement("style");return document.head.appendChild(e),t.forEach(t=>e.sheet.insertRule(t)),e},t.makeTabGrid=async function(e=!1,i=0){let n=await tri.browserBg.tabs.query(e?{}:{currentWindow:!0}),r=n.slice(i,i+t.maxCells),a=document.createElement("div");a.style.display="grid",a.style.position="fixed",a.style.top=t.topOffset+"rem",a.style.width="100%",a.style.height="fit-content",a.style["z-index"]=2147483645,a.style["grid-template-columns"]=(100-t.widthPercentage)/2+"fr "+t.widthPercentage+"fr "+(100-t.widthPercentage)/2+"fr";let l=document.createElement("div"),d=document.createElement("div"),o=document.createElement("div"),c=document.createElement("div");o.id="tri-tabs-prev",c.id="tri-tabs-prev",c.innerText="->",o.className="tri-tabs-more",c.className="tri-tabs-more";let s=Math.min(t.maxColumns,r.length);window.innerWidth*t.widthPercentage*.01/s<t.minCellWidth&&(s=Math.max(1,Math.floor(window.innerWidth/t.minCellWidth)));let p=0,m=-1,g=t.gridFromArr(r,s,function(i,n){let r=p;m!==i.windowId&&(m=i.windowId,r=++p);let a=document.createElement("p"),l=document.createElement("p");if(a.className="tri-tab-title",l.className="tri-tab-url",t.bFavicons){if(i.incognito){let d=document.createElement("img");d.src="chrome://global/skin/icons/indicator-private-browsing.svg",a.appendChild(d)}else a.style["padding-left"]=2*t.iconSize+"em";if(void 0!==i.favIconUrl){let o=document.createElement("img");o.src=i.favIconUrl,l.appendChild(o)}else l.style["padding-left"]=2*t.iconSize+"em"}let c=t.bTabIdInTitle?(e?p+"."+(i.index+1):i.index+1)+" ":"";a.insertAdjacentText("beforeEnd",c+i.title),l.insertAdjacentText("beforeEnd",i.url),n.appendChild(a),n.appendChild(document.createElement("br")),n.appendChild(l),n.onclick=()=>tri.excmds.tab((e?r+".":"")+(i.index+1))});g.style["grid-gap"]="5px",g.className="tri-grid-tabs-container",a.appendChild(l),a.appendChild(g),a.appendChild(d),document.body.parentElement.appendChild(a),void 0===t.stylesheet?t.stylesheet=t.addStylesheet(t.stylerules):t.stylesheet.disabled=!1;let h=tri.hinting_content.hintables(".tri-grid-tabs-container>div")[0].elements.length;return i+h<n.length&&(d.appendChild(c),c.onclick=()=>t.hint(e,i+h)),i>0&&(o.innerText="<-",l.appendChild(o),o.onclick=()=>t.hint(e,Math.max(0,i-h))),a},t.hint=async function(e=!1,i=0){let n=await t.makeTabGrid(e,i);return tri.excmds.hint("-c",".tri-grid-tabs-container>div,.tri-tabs-more").then(function(t){return n.remove(),t})}}tri.hinttabspopup.hint()

command hinttaball js if(void 0===tri.hinttabspopup){tri.hinttabspopup={};let t=tri.hinttabspopup;t.maxColumns=3,t.maxCells=30,t.widthPercentage=75,t.topOffset=7,t.minCellWidth=50,t.bTabIdInTitle=!1,t.gridGap="5px",t.bFavicons=!0,t.iconSize=1,t.stylerules=[".tri-grid-tabs-container { height: fit-content; font-family: var(--tridactyl-cmdl-font-family); color: var(--tridactyl-cmdl-fg); font-size: var(--tridactyl-cmdl-font-size); filter: drop-shadow(0 0 10rem #3a0080); }",".tri-grid-tabs-container>div { padding: 0.5em; overflow: clip; text-overflow: ellipsis; white-space: nowrap; text-align: left; background-color: #101216 !important; padding-left: 1.5em; padding-right: 1.5em; } ",".tri-grid-tabs-container>div>p { display: inline; } ",".tri-grid-tabs-container>div>p.tri-tab-title { color: #e4e4e4 !important; }",".tri-grid-tabs-container>div>p.tri-tab-url { color: slateblue !important; } ",".tri-grid-tabs-container>div>p>img { padding: 0 1em 0 0; display: inline-block; vertical-align: middle; height:"+t.iconSize+"em; }",".tri-grid-tabs-container>div.TridactylHintActive { background-color: #202020 !important; } ",".tri-grid-tabs-container>div.TridactylHintActive>p {  } ",".tri-grid-tabs-container>div.TridactylHintActive>p.tri-tab-title { color: white !important; }",".tri-grid-tabs-container>div.TridactylHintActive>p.tri-tab-url { color: yellow !important; } ",".tri-grid-tabs-container>div>p>img {  }",".tri-tabs-more { margin-left:"+t.gridGap+"; margin-right:"+t.gridGap+"; height:100%; background-color: #101216 !important; display: flex; align-items: center; justify-content: center; color: #e4e4e4 !important; } "],t.gridFromArr=function(t,e,i){t.length;let n=document.createElement("div");return n.setAttribute("style","grid-template-columns: repeat("+e+", minmax(0, 1fr));"),n.style.display="grid",t.forEach(function(t){let e=document.createElement("div");i(t,e),n.appendChild(e)}),n},t.addStylesheet=function(t){let e=document.createElement("style");return document.head.appendChild(e),t.forEach(t=>e.sheet.insertRule(t)),e},t.makeTabGrid=async function(e=!1,i=0){let n=await tri.browserBg.tabs.query(e?{}:{currentWindow:!0}),r=n.slice(i,i+t.maxCells),a=document.createElement("div");a.style.display="grid",a.style.position="fixed",a.style.top=t.topOffset+"rem",a.style.width="100%",a.style.height="fit-content",a.style["z-index"]=2147483645,a.style["grid-template-columns"]=(100-t.widthPercentage)/2+"fr "+t.widthPercentage+"fr "+(100-t.widthPercentage)/2+"fr";let l=document.createElement("div"),d=document.createElement("div"),o=document.createElement("div"),c=document.createElement("div");o.id="tri-tabs-prev",c.id="tri-tabs-prev",c.innerText="->",o.className="tri-tabs-more",c.className="tri-tabs-more";let s=Math.min(t.maxColumns,r.length);window.innerWidth*t.widthPercentage*.01/s<t.minCellWidth&&(s=Math.max(1,Math.floor(window.innerWidth/t.minCellWidth)));let p=0,m=-1,g=t.gridFromArr(r,s,function(i,n){let r=p;m!==i.windowId&&(m=i.windowId,r=++p);let a=document.createElement("p"),l=document.createElement("p");if(a.className="tri-tab-title",l.className="tri-tab-url",t.bFavicons){if(i.incognito){let d=document.createElement("img");d.src="chrome://global/skin/icons/indicator-private-browsing.svg",a.appendChild(d)}else a.style["padding-left"]=2*t.iconSize+"em";if(void 0!==i.favIconUrl){let o=document.createElement("img");o.src=i.favIconUrl,l.appendChild(o)}else l.style["padding-left"]=2*t.iconSize+"em"}let c=t.bTabIdInTitle?(e?p+"."+(i.index+1):i.index+1)+" ":"";a.insertAdjacentText("beforeEnd",c+i.title),l.insertAdjacentText("beforeEnd",i.url),n.appendChild(a),n.appendChild(document.createElement("br")),n.appendChild(l),n.onclick=()=>tri.excmds.tab((e?r+".":"")+(i.index+1))});g.style["grid-gap"]="5px",g.className="tri-grid-tabs-container",a.appendChild(l),a.appendChild(g),a.appendChild(d),document.body.parentElement.appendChild(a),void 0===t.stylesheet?t.stylesheet=t.addStylesheet(t.stylerules):t.stylesheet.disabled=!1;let h=tri.hinting_content.hintables(".tri-grid-tabs-container>div")[0].elements.length;return i+h<n.length&&(d.appendChild(c),c.onclick=()=>t.hint(e,i+h)),i>0&&(o.innerText="<-",l.appendChild(o),o.onclick=()=>t.hint(e,Math.max(0,i-h))),a},t.hint=async function(e=!1,i=0){let n=await t.makeTabGrid(e,i);return tri.excmds.hint("-c",".tri-grid-tabs-container>div,.tri-tabs-more").then(function(t){return n.remove(),t})}}tri.hinttabspopup.hint(true)


// and bind to keys

bind T hinttaball

// default T bind is current_url tabopen
